<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–†–æ—Å–Ω–µ—Ñ—Ç—å - –ß–∞—Ç —Å –ò–ò –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <img src="{{ url_for('static', filename='images/Rosneft_Logo_2016.png') }}"
     alt="–†–æ—Å–Ω–µ—Ñ—Ç—å"
     class="logo-img"
     onclick="window.location.href='/'"
     style="cursor: pointer;">
      <div class="header-actions">
        <button class="notifications-button" id="notificationsButton">
          <svg class="notification-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 8C18 6.4087 17.3679 4.88258 16.2426 3.75736C15.1174 2.63214 13.5913 2 12 2C10.4087 2 8.88258 2.63214 7.75736 3.75736C6.63214 4.88258 6 6.4087 6 8C6 15 3 17 3 17H21C21 17 18 15 18 8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M13.73 21C13.5542 21.3031 13.3019 21.5547 12.9982 21.7295C12.6946 21.9044 12.3504 21.9965 12 21.9965C11.6496 21.9965 11.3054 21.9044 11.0018 21.7295C10.6982 21.5547 10.4458 21.3031 10.27 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="notification-badge" id="notificationBadge">0</span>
        </button>
        <div class="profile" id="profileButton">
          <div class="profile-avatar" id="userInitials">{{ user_initials }}</div>
          <span class="profile-name" id="userName">{{ user_name }}</span>
        </div>
      </div>
    </div>
  </header>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è -->
  <div class="profile-modal" id="profileModal">
    <div class="profile-modal-content">
      <button class="back-button" id="backButton">‚Üê –ù–∞–∑–∞–¥</button>
      <div class="profile-modal-header">
        <div class="profile-modal-avatar" id="modalUserInitials">{{ user_initials }}</div>
        <div class="profile-modal-info">
          <h3 id="modalUserName">{{ user_full_name }}</h3>
          <p id="modalUserPosition">{{ user_position }}</p>
        </div>
      </div>
      <div class="profile-menu">
        <button class="profile-menu-item" id="myTasksButton">
          <span class="menu-icon">üìã</span>
          <span>–ú–æ–∏ –∑–∞–¥–∞—á–∏</span>
        </button>
        <button class="profile-menu-item" id="newTaskButton">
          <span class="menu-icon">‚ûï</span>
          <span>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É</span>
        </button>
      </div>
      <button class="logout-button" id="logoutButton">–í—ã–π—Ç–∏</button>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
  <div class="notifications-modal" id="notificationsModal">
    <div class="notifications-modal-content">
      <button class="back-button" id="notificationsBackButton">‚Üê –ù–∞–∑–∞–¥</button>
      <h3>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
      <div class="notifications-list" id="notificationsList">
        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
      </div>
    </div>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —á–∞—Ç–∞ -->
  <main class="container">
    <div class="chat-header-section">
      <h1 id="taskTitle">–ß–∞—Ç —Å –ò–ò –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º</h1>
      <p class="task-info" id="taskInfo">
        {% if task %}
          –ó–∞–¥–∞—á–∞: {{ task.title }} | –°—Ä–æ–∫: {{ task.due_date.strftime('%d.%m.%Y %H:%M') if task.due_date else '' }}
        {% endif %}
      </p>
      <button class="back-to-tasks-btn" id="backToTasksBtn">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∑–∞–¥–∞—á–∞–º</button>
    </div>

    <div class="chat-box" id="chatBox">
      <div class="chat-header">
        <div class="bot-avatar">ü§ñ</div>
        <div class="chat-header-text">
          <h2>–ò–ò –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç</h2>
          <p id="chatStatus">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</p>
        </div>
      </div>

      <div class="messages" id="messages">
        <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
      </div>

      <div class="input-area">
        <input
          type="text"
          id="messageInput"
          placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –æ –∑–∞–¥–∞—á–µ –∏–ª–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–∏..."
          autocomplete="off"
          {% if not session_id %}disabled{% endif %}
        />
        <button class="send-button" id="sendButton" {% if not session_id %}disabled{% endif %}>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </div>
    </div>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Å—Å–∏–∏ (—Å–∫—Ä—ã—Ç–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) -->
    <input type="hidden" id="sessionId" value="{{ session_id }}">
    <input type="hidden" id="taskId" value="{{ task.id if task else '' }}">
  </main>

  <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
<!-- –ü–ª–∞–≤–∞—é—â–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π -->
<div class="floating-unread-indicator" id="floatingUnreadIndicator">
    <span id="floatingUnreadCount">0</span> –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
    <span class="arrow">‚Üì</span>
</div>
</body>
</html>